import React, { useEffect, useState } from 'react';
import { NFTMintButton } from './components/NFTMintButton';
import { WalletSigner } from './components/WalletSigner';
import { CONFIG } from './config/config';
import './styles/index.css';

function App() {
  const [isConnected, setIsConnected] = useState(false);
  const [networkError, setNetworkError] = useState('');

  // 检查钱包连接和网络状态
  useEffect(() => {
    const checkConnection = async () => {
      if (window.ethereum) {
        try {
          // 检查是否已连接
          const accounts = await window.ethereum.request({ method: 'eth_accounts' });
          setIsConnected(accounts.length > 0);

          // 检查网络
          const chainId = await window.ethereum.request({ method: 'eth_chainId' });
          if (chainId !== '0x13881') { // Mumbai testnet
            setNetworkError('Please switch to Mumbai Testnet');
          } else {
            setNetworkError('');
          }

          // 监听账户变化
          window.ethereum.on('accountsChanged', (accounts: string[]) => {
            setIsConnected(accounts.length > 0);
          });

          // 监听链变化
          window.ethereum.on('chainChanged', (chainId: string) => {
            if (chainId !== '0x13881') {
              setNetworkError('Please switch to Mumbai Testnet');
            } else {
              setNetworkError('');
            }
          });
        } catch (error) {
          console.error('Error checking connection:', error);
        }
      }
    };

    checkConnection();
  }, []);

  return (
    <div className="app-container">
      <header className="app-header">
        <h1>SweetAI NFT Dashboard</h1>
        {networkError && (
          <p className="error-message">{networkError}</p>
        )}
      </header>

      <main className="app-main">
        <section className="wallet-section">
          <h2>Wallet Connection</h2>
          <WalletSigner />
        </section>

        <section className="mint-section">
          <h2>NFT Minting</h2>
          <NFTMintButton />
        </section>

        <section className="info-section">
          <h3>Contract Information</h3>
          <p>Network: Polygon Mumbai Testnet</p>
          <p>Contract: {CONFIG.nftContract}</p>
          <a 
            href={`https://mumbai.polygonscan.com/address/${CONFIG.nftContract}`}
            target="_blank"
            rel="noopener noreferrer"
            className="contract-link"
          >
            View on PolygonScan
          </a>
        </section>
      </main>

      <footer className="app-footer">
        <p>Made with ❤️ by SweetAI</p>
      </footer>
    </div>
  );
}

export default App;
